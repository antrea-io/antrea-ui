name: Documentation
on:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
    - name: Check-out code
      uses: actions/checkout@v3
    - name: Checking whether autogenerated Helm chart documentation is up-to-date
      working-directory: build/charts/
      run: |
        make helm-docs
        DIFF=$(git diff .)
        if [ -n "$DIFF" ]; then
          echo "The Helm chart documentation is out-of-date; please run 'make helm-docs' in 'build/charts/' and commit the changes"
          exit 1
        fi
